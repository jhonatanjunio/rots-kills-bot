# ğŸ® ROTS War Bot

## ğŸ“‹ Sobre
Bot do Discord desenvolvido para monitorar e gerenciar estatÃ­sticas de jogadores do Saiyans Return (ROTS). O bot rastreia mortes (PvP e PvE), mantÃ©m rankings, envia alertas e fornece informaÃ§Ãµes detalhadas sobre o desempenho dos jogadores aliados e inimigos.

## âš¡ Funcionalidades Atuais

### 1. Monitoramento de Jogadores
- Rastreamento automÃ¡tico de mortes (PvP e PvE)
- Sistema de aliados e inimigos
- AtualizaÃ§Ã£o em tempo real das informaÃ§Ãµes dos jogadores
- DetecÃ§Ã£o e registro de troca de classe e mudanÃ§a de nick

### 2. Comandos Discord DisponÃ­veis
- `/addplayer` â€” Adiciona um jogador ao monitoramento (aliado ou inimigo)
- `/removeplayer` â€” Remove um jogador do monitoramento
- `/playerstats` â€” Exibe estatÃ­sticas detalhadas do jogador (nÃ­vel, mortes, assassino mais frequente, Ãºltima morte, etc)
- `/ranking` â€” Mostra ranking de KDA (Kills/Deaths/Assists) dos aliados, com opÃ§Ã£o de perÃ­odo (24h, 7d, 30d, total)
- `/war` â€” Mostra estatÃ­sticas de guerra entre aliados e inimigos em um perÃ­odo customizÃ¡vel (ex: 1d, 2h 30m)
- `/shutdown` â€” Desliga o bot de forma segura

### 3. Sistema de EstatÃ­sticas
- Contagem de mortes por jogador
- Rastreamento de KDA (Kills, Deaths, Assists)
- HistÃ³rico de combates detalhado
- AnÃ¡lise de perÃ­odos customizÃ¡veis (24h, 7d, 30d, total)
- Ranking visual (imagem) e em tabela ASCII

### 4. NotificaÃ§Ãµes e Alertas
- Alertas de morte em tempo real (PvP e PvE) via Discord Embed
- Detalhes do combate (quem matou, maior dano, horÃ¡rio, etc)
- NotificaÃ§Ãµes de troca de classe e mudanÃ§a de nick
- Logs separados para mortes por monstros

### 5. Recursos TÃ©cnicos e Arquiteturais
- Cache inteligente para evitar requisiÃ§Ãµes duplicadas Ã  API
- Sistema de filas e robÃ´s para processamento paralelo dos jogadores
- Sistema de backup e restauraÃ§Ã£o automÃ¡tica do banco de dados
- Logging detalhado e tratamento robusto de erros
- ProteÃ§Ã£o contra duplicaÃ§Ã£o de dados e rate limiting

### 6. SeguranÃ§a
- Rate limiting para evitar banimento por excesso de requisiÃ§Ãµes
- ValidaÃ§Ã£o de entradas e gerenciamento seguro de tokens

## ğŸ”§ Tecnologias Utilizadas

- TypeScript (strict mode)
- Discord.js
- Puppeteer
- Jest (testes)
- Node.js
- Moment.js

## ğŸ’» Arquitetura

O projeto estÃ¡ organizado em vÃ¡rios mÃ³dulos principais:

1. **ServiÃ§os Core**
   - BrowserService: InteraÃ§Ã£o com a API do jogo
   - DeathMonitor: Sistema de monitoramento
   - Database: Gerenciamento de dados
   - GameAPI: Interface com a API do jogo

2. **Comandos Discord**
   - Sistema modular de comandos
   - Gerenciamento de interaÃ§Ãµes
   - FormataÃ§Ã£o rica de mensagens

3. **Sistema de Testes**
   - Testes de integraÃ§Ã£o
   - Mocks para serviÃ§os externos
   - Ambiente de teste isolado

## ğŸš€ Destaques TÃ©cnicos

1. **Sistema de Cache Inteligente**
- ImplementaÃ§Ã£o de cache em memÃ³ria para reduzir requisiÃ§Ãµes Ã  API
- Ãndice otimizado para logs de morte usando Set para evitar duplicatas
- Sistema de hash para identificaÃ§Ã£o Ãºnica de eventos
```typescript
private static createDeathLogHash(deathLog: DeathLogEntry): string {
return `${deathLog.playerName}-${deathLog.killed_by}-${deathLog.mostdamage_by}-${deathLog.timestamp}-${deathLog.level}`;
}
```

2. **Monitoramento em Tempo Real**
- Sistema robusto de monitoramento usando Puppeteer
- Processamento assÃ­ncrono de eventos de morte
- NotificaÃ§Ãµes instantÃ¢neas via Discord Embeds
```typescript
private async processNewDeaths(player: any, deaths: any[]) {
  const deathAlert = new EmbedBuilder()
    .setColor('#FF0000')
    .setTitle('âš ï¸ ALERTA DE MORTE âš ï¸')
    // ... configuraÃ§Ã£o do embed
    .setFooter({ text: 'Mantenha-se alerta! Proteja seus aliados!' });
}
```

3. **Interface Rica com Discord**
- Comandos Slash integrados
- Embeds personalizados para melhor visualizaÃ§Ã£o
- Sistema de rankings com perÃ­odos customizÃ¡veis
```typescript
export async function showRanking(interaction: ChatInputCommandInteraction) {
  const period = interaction.options.getString('period');
  const options = parseRankingPeriod(period);
  // ... lÃ³gica de ranking
}
```

4. **Sistema de Testes Abrangente**
- Mocks para serviÃ§os externos
- Testes de integraÃ§Ã£o automatizados
- Ambiente de teste isolado
```typescript
describe('DeathMonitor', () => {
  let monitor: DeathMonitor;
  let mockClient: Client;
  // ... configuraÃ§Ã£o de testes
});
```

5. **Arquitetura Modular**
- SeparaÃ§Ã£o clara de responsabilidades
- ServiÃ§os independentes e bem definidos
- Sistema de tipos forte com TypeScript

Cada um destes destaques tÃ©cnicos foi implementado pensando em performance, manutenibilidade e confiabilidade do sistema.

## ğŸ” SeguranÃ§a

- Sistema de rate limiting
- ProteÃ§Ã£o contra duplicaÃ§Ã£o de dados
- ValidaÃ§Ã£o de entradas
- Gerenciamento seguro de tokens

## ğŸ“Š Funcionalidades de Monitoramento

- Rastreamento de mortes em tempo real (PvP e PvE)
- AnÃ¡lise de estatÃ­sticas e histÃ³rico de combates
- Sistema de ranking e guerra entre times
- Logs detalhados de mortes por monstros e trocas de classe

## ğŸ› ï¸ Recursos TÃ©cnicos

- Arquitetura modular e escalÃ¡vel
- Sistema de logging e tratamento de erros
- Testes automatizados

---

## âš ï¸ LimitaÃ§Ãµes e TODO

- [ ] **ImportaÃ§Ã£o de lista de jogadores:** Ainda nÃ£o hÃ¡ comando ou funÃ§Ã£o utilitÃ¡ria para importar uma lista de jogadores via comando Discord. Atualmente, a importaÃ§Ã£o em lote sÃ³ Ã© possÃ­vel via scripts ou manipulaÃ§Ã£o direta do arquivo `data.json` (ex: `src/scripts/setupExecutableDatabase.ts`).
- [âœ…] Registro de mortes por monstros e envio para canal especÃ­fico
- [âœ…] Registro de troca de classe e envio para canal especÃ­fico
- [âœ…] FunÃ§Ã£o de guerra com anÃ¡lise de perÃ­odo customizÃ¡vel e ranking de aliados